{% extends 'base.html' %}
{% load static humanize %}
{% load markdown_extras %}

{% block title %}{{ schedule.title }} - ì¼ì • ìƒì„¸ | ViaPlan ì—¬í–‰ì‚¬{% endblock %}

{% block extra_css %}
{{ block.super }}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
  .hero-section {
    background: linear-gradient(to right, #1976d2, #42a5f5);
    color: white;
    padding: 60px 20px;
    text-align: center;
  }

  a {
    color: white;
  }

  a:hover {
    color: rgb(83, 83, 255);
  }

  .hero-section h1 {
    font-size: 2.5rem;
    font-weight: bold;
    margin-bottom: 10px;
  }

  .hero-section p {
    font-size: 1.2rem;
    opacity: 0.9;
  }

  .card-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    padding: 40px 20px 20px;
    gap: 24px;
    background: #f9f9f9;
  }

  .info-card {
    background: white;
    padding: 24px;
    border-radius: 12px;
    width: 300px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
  }

  .info-card:hover {
    transform: translateY(-5px);
  }

  .info-card h3 {
    font-size: 1.2rem;
    color: #0077c2;
    margin-bottom: 12px;
  }

  .info-card p {
    font-size: 0.95rem;
    margin: 6px 0;
  }

  .btn-wrapper {
    text-align: center;
    margin: 30px 0 10px;
  }

  .btn-wrapper .btn {
    margin: 0 8px;
  }

  .ai-answer-box {
    background: #fff;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
    max-width: 900px;
    margin: 40px auto;
  }

  .ai-question-form {
    margin-top: 32px;
    background: #eef7ff;
    padding: 24px;
    border-radius: 10px;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
  }
  
</style>
{% endblock %}

{% block content %}

<div class="hero-section">
  <h1>{{ schedule.title }}</h1>
  <p>ì—¬í–‰ ì¼ì • ìƒì„¸ ë³´ê¸°</p>
</div>

<div class="card-container">
  <div class="info-card">
    <h3>ğŸ“Œ ê¸°ë³¸ ì •ë³´</h3>
    <p>ê¸°ê°„: {{ schedule.start_date }} ~ {{ schedule.end_date }}</p>
    <p>ì˜ˆì‚°: {{ schedule.budget|intcomma }}ì›</p>
    <p>ì—¬í–‰ì§€: {{ schedule.destination }}</p>
    <p>íƒœê·¸: {{ schedule.tag|default:"-" }}</p>
  </div>

  <div class="info-card">
    <h3>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ì°¸ê°€ì</h3>
    <p>ì¸ì›ìˆ˜: {{ schedule.num_people }}</p>
    <p>êµ¬ì„±: {{ schedule.participant_info }}</p>
    <p>ë°˜ë ¤ë™ë¬¼ ë™ë°˜: {{ schedule.pet_friendly|yesno:"ì˜ˆ,ì•„ë‹ˆì˜¤" }}</p>
  </div>

  <div class="info-card">
    <h3>ğŸš— ì´ë™ & ìˆ™ë°•</h3>
    <p>êµí†µ: {{ schedule.transport_info }}</p>
  </div>

  <div class="info-card">
    <h3>ğŸ¯ ì„ í˜¸ ìŠ¤íƒ€ì¼</h3>
    <p>
      ìŠ¤íƒ€ì¼:
      <br>&ensp;ì„ í˜¸ í™œë™: {{ schedule.preferred_activities }}
      <br>&ensp;ì„ í˜¸ ìŒì‹: {{ schedule.meal_preference }}
    </p>
    <p>ì¤‘ìš” ìš”ì†Œ: {{ schedule.important_factors|default:"ì—†ìŒ" }}</p>
    <p>ì½”ë©˜íŠ¸: {{ schedule.notes|default:"ì—†ìŒ" }}</p>
  </div>
</div>

<!-- âœ… ë²„íŠ¼ì„ ì¹´ë“œ ì•„ë˜ë¡œ ë°”ë¡œ ì´ë™ -->
<div class="btn-wrapper">
  <a href="{% url 'travel_input:schedule_update' schedule.pk %}" class="btn btn-primary">ì¼ì • ìˆ˜ì •</a>
  <a href="{% url 'travel_input:schedule_delete' schedule.pk %}" class="btn btn-danger">ì¼ì • ì‚­ì œ</a>
  <a href="{% url 'travel_input:schedule_list' %}" class="btn btn-secondary">ëª©ë¡ìœ¼ë¡œ</a>
</div>

{% if ai_answer %}
<div class="ai-answer-box">
  <h2 style="text-align:center; color:#0077c2; margin-bottom:20px;">âœ¨ AI ì¶”ì²œ ì¼ì •</h2>
  <pre style="white-space: pre-wrap; background: #f4faff; padding: 20px; border-radius: 8px;">{{ ai_answer|safe }}</pre>
</div>
{% endif %}

<div class="ai-question-form">
  <form method="post" action="">
    {% csrf_token %}
    <label for="question" style="font-weight:bold;">AIì—ê²Œ ì§ˆë¬¸í•˜ê¸°</label>
    <textarea name="question" id="question" rows="2" style="width:100%; margin-top:8px;" placeholder="ì˜ˆ: ì¶”ì²œ ë§›ì§‘ì´ ìˆì„ê¹Œìš”?"></textarea>
    <button type="submit" class="btn btn-primary mt-2">AIì—ê²Œ ë¬¼ì–´ë³´ê¸°</button>
  </form>

  {% if ai_answers %}
  <div class="ai-answers mt-4">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <strong>ì´ì „ AI ë‹µë³€</strong>
      <a href="?clear_answers=1" class="btn btn-sm btn-outline-secondary">ë‹µë³€ ì´ˆê¸°í™”</a>
    </div>
    {% for answer in ai_answers %}
    <div class="ai-answer" style="background:#fff; padding:16px; margin-top:10px; border-radius:8px; border:1px solid #eee;">
      {{ answer|markdown_to_html|safe }}
    </div>
    {% endfor %}
  </div>
  {% endif %}
</div>

{% endblock %}
