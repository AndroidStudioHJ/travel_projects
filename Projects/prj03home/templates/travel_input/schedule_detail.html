{% extends 'base.html' %}
{% load static humanize %}
{% load markdown_extras %}
{% block title %}{{ schedule.title }} - 일정 상세{% endblock %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
{% block extra_css %}
{{ block.super }}
<style>
  .card-grid {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 24px;
    padding: 40px;
  }

  .card-item {
    background-color: rgba(255, 255, 255, 0.9);
    color: #111;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    width: 280px;
    min-height: 180px;
    transition: transform 0.3s;
  }

  .card-item:hover {
    transform: translateY(-4px);
  }

  .card-item h3 {
    font-size: 1.2rem;
    margin-bottom: 12px;
    color: #0d47a1;
  }

  .card-item p {
    font-size: 1rem;
    margin: 6px 0;
    word-break: keep-all;
  }
</style>
{% endblock %}

{% block content %}
<h2 style="text-align: center; margin: 40px 0;">여행 일정 상세</h2>

<div class="card-grid">
  <div class="card-item">
    <h3>기본 정보</h3>
    <p>여행 제목: {{ schedule.title }}</p>
    <p>여행 기간: {{ schedule.start_date }} ~ {{ schedule.end_date }}</p>
    <p>예산: {{ schedule.budget|intcomma }}원</p>
  </div>

  <div class="card-item">
    <h3>참가자 정보</h3>
    <p>인원수: {{ schedule.num_people }}</p>
    <p>구성: {{ schedule.composition }}</p>
    <p>반려동물 동반: {{ schedule.pet_friendly|yesno:"예,아니오" }}</p>
  </div>

  <div class="card-item">
    <h3>장소 정보</h3>
    <p>여행지: {{ schedule.destination }}</p>
    <p>태그: {{ schedule.tag|default:"없음" }}</p>
  </div>

  <div class="card-item">
    <h3>교통 & 숙소</h3>
    <p>이동수단: {{ schedule.transport }}</p>
    <p>숙소요청: {{ schedule.lodging_request }}</p>
  </div>

  <div class="card-item">
    <h3>기타</h3>
    <p>스타일: {{ schedule.travel_style }}</p>
    <p>중요요소: {{ schedule.important_factors|default:"없음" }}</p>
    <p>코멘트: {{ schedule.notes|default:"" }}</p>
  </div>
</div>

{% if ai_answer %}
<hr style="margin: 40px 0;">
<h2 style="text-align:center; margin-bottom: 20px;">AI 추천 일정</h2>
<div class="ai-answer">
  <pre style="white-space: pre-wrap; background:#f8f8f8; padding: 20px; border-radius: 12px;">{{ ai_answer|safe }}</pre>
</div>
{% endif %}

<!-- AI 질문 및 답변 -->
<div class="section-title" style="margin-top:32px; text-align:center; font-weight:bold; font-size:1.2rem;">AI 답변</div>
<div class="section-content" style="background:#f8f8ff; border-radius:8px; padding:12px; max-width: 900px; margin: 0 auto;">
  <form method="post" action="">
    {% csrf_token %}
    <textarea name="question" rows="2" style="width:100%;" placeholder="AI에게 궁금한 점을 입력하세요 (예: 이 일정에 추천할만한 장소는?)"></textarea>
    <button type="submit" class="btn btn-primary" style="margin-top:8px;">AI에게 물어보기</button>
  </form>
  {% if ai_answers %}
  <div class="ai-answers" style="margin-top:16px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
      <strong>AI 답변:</strong>
      <a href="?clear_answers=1" class="btn btn-sm btn-outline-secondary" style="font-size: 0.8rem;">답변 초기화</a>
    </div>
    {% for answer in ai_answers %}
    <div class="ai-answer" style="margin-top:8px; padding: 8px; background: white; border-radius: 4px;">{{ answer|markdown_to_html|safe }}</div>
    {% endfor %}
  </div>
  {% endif %}
</div>

<div class="text-center mt-4">
  <a href="{% url 'travel_input:schedule_update' schedule.pk %}" class="btn btn-primary">수정</a>
  <a href="{% url 'travel_input:schedule_delete' schedule.pk %}" class="btn btn-danger">삭제</a>
  <a href="{% url 'travel_input:schedule_list' %}" class="btn btn-secondary">목록으로</a>
</div>
{% endblock %}
